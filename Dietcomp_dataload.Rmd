---
title: "REEM oracle downloads"
author: "Kerim Aydin"
date: "8/24/2022"
output: html_notebook
---
## REEM Diet Composition Tools
This set of tools generates diet composition estimates from REEM BTS data, 
includes queries for bottom-trawl survey data provided by RACE.  All of these 
steps should be run from the top directory of this package, so please ensure
that the working directory is set correctly, and add a directory-setting command
if needed.  This also loads user-supplied parameters from user.R (most R files
are in the R subdirectory; user.R is in the top directory).

```{r environ}
library("RODBC")
library("getPass")
source("R/010_RACE_data_from_oracle.R")

# setwd() here if needed - code assumes everything runs from main repo directory.
channel <- oracle.connect("AFSC")  # Oracle connection name in odbc, may differ by user (eg "AFSCP1")

```

## Querying Oracle
Here, we download tables from RACEBASE (Oracle tables with names prefixed by RACEBASE
like RACEBACE.HAUL) and save them as .csvs in the given path directory.  This does *not*
put the data in the workspace.  The list of tables can be changed (e.g. to refresh a
single table only).  These queries select all table fields (no data manipulations).

```{r query_RACE, eval=FALSE}

racebase.tables   <- c("CATCH","HAUL","LENGTH","SPECIMEN", "STRATUM", "STATIONS",
                       "SPECIES", "CRUISE", "SPECIES_CLASSIFICATION", "SIZECOMP_TOTAL")

racebase.download(channel, tables=racebase.tables, path="data/local_racebase")

```

This loads REEM data.  These are not loaded completely "RAW", the query script
performs some lookups on the Oracle end as contained in these scripts, and
does not pull all fields:

```{r query_REEM, eval=FALSE}
source("./R/015_REEM_data_from_oracle.R")
```

Closing the connection once finished:
```{r query_close, eval=FALSE}

oracle.disconnect(channel)

```


